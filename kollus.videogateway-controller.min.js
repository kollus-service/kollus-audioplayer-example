/**
 * Kollus-VideogatewayController (10-22-2018)
 * Copyright (c) 2018, Catenoid Incorporated. All rights reserved.
 *
 * @version 0.0.9
 * @license ISC
 */
!function(t){"function"==typeof define&&define.amd?define(t()):"object"==typeof exports?t.exports=t():(void 0===window.Kollus&&(window.Kollus={}),window.Kollus.Utility=t())}(function(){var t=window.KollusException=function(t,e){this.message=t,this.code=e||-1,this.toString=function(){return this.message+" ["+this.code+"]"}};Function.prototype.bind||(Function.prototype.bind=function(t){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var e=Array.prototype.slice.call(arguments,1),n=this,o=function(){},i=function(){return n.apply(this instanceof o&&t?this:t,e.concat(Array.prototype.slice.call(arguments)))};return o.prototype=this.prototype,i.prototype=new o,i});var e={merge_object:function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}},n=function(t){this.options=e.merge_object({scope:"*",use_log:!1},t||{})};n.prototype.log=function(t,e,n){!0===this.options.use_log&&void 0!==window.console&&console.log((new Date).toLocaleString()+" - "+t+": ["+this.options.scope+"/"+e+"] "+n)},n.prototype.info=function(t,e){this.log("info",t,e)},n.prototype.debug=function(t,e){this.log("debug",t,e)},n.prototype.error=function(t,e){this.log("error",t,e)},e.create_logger=function(t){return new n(t)};var o=0;e.uid=function(t){return(t||"kollus")+"-"+o++},e.listen=function(e,n){if("function"!=typeof n)throw new t("listener is not callable.",-1);return{to:function(o){if(o.addEventListener)o.addEventListener(e,n,!1);else{if(!o.attachEvent)throw new t("object does not support event.",-1);o.attachEvent("on"+e,n)}}}};var i=function(){this.listeners={}};return i.prototype.on=function(e,n){if("function"!=typeof n)throw new t("listener is not callable.",-1);return void 0===this.listeners[e]&&(this.listeners[e]=[]),this.listeners[e].push(n),this},i.prototype.off=function(t){if(void 0!==this.listeners[t]){for(var e=0,n=this.listeners[t].length;e<n;e++)this.listeners[t][e]=null;this.listeners[t]=[]}return this},i.prototype.trigger=function(){if(arguments.length>=1){var t=Array.prototype.slice.call(arguments),e=t.shift();if(void 0!==this.listeners[e])for(var n=0,o=this.listeners[e].length;n<o;n++)this.listeners[e][n].apply(this,t)}},e.create_event_dispatcher=function(){return new i},e.make_fullscreen=function(t){t.requestFullscreen?t.requestFullscreen():t.msRequestFullscreen?t.msRequestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullscreen&&t.webkitRequestFullscreen()},e.delayCallback=function(t,e){for(var n=new Date;new Date-n<=t;);e&&e()},e});!function(t){"function"==typeof define&&define.amd?define(t()):"object"==typeof exports?t.exports=t():(void 0===window.Kollus&&(window.Kollus={}),window.Kollus.PostMessage=t())}(function(){var t=Kollus.Utility.create_logger({scope:"PostMessage",use_log:!1}),i=window.KollusPostMessageException=function(t,i){this.message=t,this.code=i||-1,this.toString=function(){return this.message+" ["+this.code+"]"}},e=function(e){if(e.is_child?t.options.scope="<<<---"+t.options.scope:t.options.scope="---\x3e>>"+t.options.scope,t.info("SCRIPT_VERSION","v0.0.2"),this.options=Kollus.Utility.merge_object({target_window:null,target_origin:"*",use_uid_check:!0,is_child:!1},e||{}),this.event_dispatcher=new Kollus.Utility.create_event_dispatcher,this.uid=null,this.options.use_uid_check&&(this.uid=Kollus.Utility.uid("kollus-postmessage")),void 0===window.postMessage)throw new i("this browser does not support postMessage",-99);try{Kollus.Utility.listen("message",this.receive.bind(this)).to(window)}catch(t){throw new i("can`t attach event to window.",-99)}};return e.prototype.on=function(t,i){try{this.event_dispatcher.on(t,i)}catch(t){throw t}return this},e.prototype.send=function(i,e){return t.debug("send","event_name -> "+i+", data -> "+e),null!==this.options.target_window&&this.options.target_window.postMessage(JSON.stringify({event_name:i,data:void 0===e||e,uid:this.uid}),this.options.target_origin)},e.prototype.receive=function(e){if("*"!==this.options.target_origin&&this.options.target_origin!==e.origin)return t.debug("receive","event received, but origin not match. (target_origin: "+this.options.target_origin+", event.origin: "+e.origin+")"),!1;try{t.debug("receive",e.data);var s=JSON.parse(e.data);if(!0===this.options.use_uid_check&&this.uid!==s.uid)return t.debug("receive","not matched uid. this.uid -> "+this.uid+", message.uid -> "+s.uid),!1;!1===this.options.use_uid_check&&null===this.uid&&(t.debug("receive","no use_uid_check. message.uid will be set to this.uid. mesasge.uid -> "+s.uid),this.uid=s.uid),this.options.is_child&&null===this.options.target_window&&(t.debug("receive","this window is child. target_window will be set as event.source."),this.options.target_window=e.source),this.event_dispatcher.trigger(s.event_name,s.data)}catch(t){throw new i(t.message,-1)}},e});!function(t){"function"==typeof define&&define.amd?define(t()):"object"==typeof exports?t.exports=t():(void 0===window.Kollus&&(window.Kollus={}),window.Kollus.VideogatewayController=t())}(function(){var t=Kollus.Utility.create_logger({scope:"VideogatewayController",use_log:!1}),e=(window.KollusVideogatewayControllerException=function(t,e){this.message=t,this.code=e||-1,this.toString=function(){return this.message+" ["+this.code+"]"}},function(e){t.info("SCRIPT_VERSION","v0.0.9");var s=this;this.status={progress:{percent:0,position:0,duration:0},screen:"windowed",volume:50,muted:!1,jumpstep:10,scalemode:"letterbox",control_visibility:!0,speed:1,topmost:!1,video:{brightness:0,contrast:0,saturation:0},subtitle_visibility:!0,playback_rates:null,player_id:null,hardware_id:null,player_type:null,video_info:null,enable_close_event:!1,lms_data:null,video_visibility:!0},this.close_callback_fn=null,this.lms_data_callback_fn=null,document.onkeydown=function(t){if(s.status.enable_close_event){var e=window.event||t;return 8==e.keyCode||116==e.keyCode||82==e.keyCode&&e.ctrlKey?(e.keyCode=0,!1):void 0}},this.postmessage=new Kollus.PostMessage(e);var o=!1,n=0,i=setInterval(function(){++n>=50&&(clearInterval(i),t.debug("initialized","max initialize try reached.")),!0===o?(clearInterval(i),t.debug("initialized","receive initialized & clear interval function.")):(s.postmessage.send("c_initialize",!0),t.debug("initialize","send initialize command."))},100);this.event_dispatcher=Kollus.Utility.create_event_dispatcher(),this.postmessage.on("e_initialized",function(){o=!0}).on("e_progress",function(t){s.status.progress=Kollus.Utility.merge_object(s.status.progress,t),s.event_dispatcher.trigger("progress",1*t.percent,1*t.position,1*t.duration)}).on("e_screenchange",function(t){s.status.screen=t,s.event_dispatcher.trigger("screenchange",t)}).on("e_volumechange",function(t){s.status.volume=1*t,s.event_dispatcher.trigger("volumechange",1*t)}).on("e_muted",function(t){s.status.muted=t,s.event_dispatcher.trigger("muted",t)}).on("e_play",function(){s.event_dispatcher.trigger("play")}).on("e_pause",function(){s.event_dispatcher.trigger("pause")}).on("e_done",function(){s.event_dispatcher.trigger("done")}).on("e_ready",function(){s.event_dispatcher.trigger("ready")}).on("e_loaded",function(){s.event_dispatcher.trigger("loaded"),s.postmessage.send("c_set_close_callback_fn",s.close_callback_fn)}).on("e_jumpstepchange",function(t){s.status.jumpstep=1*t,s.event_dispatcher.trigger("jumpstepchange",1*t)}).on("e_scalemode",function(t){s.status.scalemode=t,s.event_dispatcher.trigger("scalemodechange",t)}).on("e_speedchange",function(t){s.status.speed=t,s.event_dispatcher.trigger("speedchange",t)}).on("e_topmost",function(t){s.status.topmost=t,s.event_dispatcher.trigger("topmostchange",t)}).on("e_videosettingchange",function(t){s.status.video=Kollus.Utility.merge_object(s.status.video,t),s.event_dispatcher.trigger("videosettingchange",t)}).on("e_html5_video_supported",function(t){s.event_dispatcher.trigger("html5_video_supported",t)}).on("e_playbackrateschange",function(t){s.status.playback_rates=t,s.event_dispatcher.trigger("playbackrateschange",t)}).on("e_subtitlevisibilitychange",function(t){s.status.subtitle_visibility=t,s.event_dispatcher.trigger("subtitlevisibilitychange",t)}).on("e_error",function(t){s.event_dispatcher.trigger("error",t)}).on("e_fetch_player_id",function(t){s.status.player_id=t}).on("e_fetch_hardware_id",function(t){s.status.hardware_id=t}).on("e_fetch_player_type",function(t){s.status.player_type=t}).on("e_fetch_video_info",function(t){s.status.video_info=t}).on("e_close",function(){t.debug("e_close","close"),s.event_dispatcher.trigger("close")}).on("e_fetch_lms_data",function(e){t.debug("e_fetch_lms_data",e),s.lms_data_callback_fn(e)})});return e.prototype.on=function(t,e){return this.event_dispatcher.on(t,e),this},e.prototype.off=function(t){return this.event_dispatcher.off(t),this},e.prototype.get_progress=function(){return this.status.progress},e.prototype.play=function(t){this.postmessage.send("c_play",t)},e.prototype.pause=function(){this.postmessage.send("c_pause")},e.prototype.set_volume=function(t){this.postmessage.send("c_set_volume",Math.min(100,Math.max(0,t)))},e.prototype.get_volume=function(){return this.status.volume},e.prototype.mute=function(){this.postmessage.send("c_mute")},e.prototype.ff=function(){this.postmessage.send("c_ff")},e.prototype.rw=function(){this.postmessage.send("c_rw")},e.prototype.set_screen=function(){this.postmessage.send("c_set_screen")},e.prototype.get_screen=function(){return this.status.screen},e.prototype.set_jumpstep=function(t){this.postmessage.send("c_set_jumpstep",1*t)},e.prototype.get_jumpstep=function(){return this.status.jumpstep},e.prototype.set_control_visibility=function(t){this.postmessage.send("c_set_control_visibility",t),this.status.control_visibility=t},e.prototype.get_control_visibility=function(){return this.status.control_visibility},e.prototype.set_scalemode=function(t){"|letterbox|stretch|zoom|none|".indexOf(t)>=0&&this.postmessage.send("c_set_scalemode",t)},e.prototype.get_scalemode=function(){return this.status.scalemode},e.prototype.set_speed=function(t){this.postmessage.send("c_set_speed",parseFloat(t).toFixed(2))},e.prototype.get_speed=function(){return this.status.speed},e.prototype.set_topmost=function(t){this.postmessage.send("c_set_topmost",t?1:0)},e.prototype.get_topmost=function(){return this.status.topmost},e.prototype.set_brightness=function(t){this.postmessage.send("c_set_brightness",Math.min(50,Math.max(-50,t)))},e.prototype.get_brightness=function(){return this.status.video.brightness},e.prototype.set_contrast=function(t){this.postmessage.send("c_set_contrast",Math.min(50,Math.max(-50,t)))},e.prototype.get_contrast=function(){return this.status.video.contrast},e.prototype.set_saturation=function(t){this.postmessage.send("c_set_saturation",Math.min(50,Math.max(-50,t)))},e.prototype.get_saturation=function(){return this.status.video.saturation},e.prototype.set_repeat_start=function(t){this.postmessage.send("c_set_sectiontime",{type:1,value:t||-1})},e.prototype.set_repeat_end=function(t){this.postmessage.send("c_set_sectiontime",{type:2,value:t||-1})},e.prototype.unset_repeat=function(){this.postmessage.send("c_set_sectiontime",{type:0,value:-1})},e.prototype.refresh_bookmark=function(){this.postmessage.send("c_refresh_bookmark")},e.prototype.enable_fullscreen_button=function(){this.postmessage.send("c_enable_fullscreen_button")},e.prototype.set_playback_rates=function(t){this.postmessage.send("c_set_playback_rates",t)},e.prototype.get_playback_rates=function(t){return JSON.parse(this.status.playback_rates)},e.prototype.set_subtitle_visibility=function(t){this.postmessage.send("c_set_subtitle_visibility",t)},e.prototype.get_player_id=function(){return this.status.player_id},e.prototype.get_hardware_id=function(){return this.status.hardware_id},e.prototype.get_player_type=function(){return this.status.player_type},e.prototype.get_video_info=function(){return this.status.video_info},e.prototype.set_lms_check=function(){this.postmessage.send("c_set_lms_check")},e.prototype.set_keyframe_seek_default=function(t){this.postmessage.send("c_set_keyframe_seek_default",t)},e.prototype.set_short_key=function(t){this.postmessage.send("c_set_short_key",t)},e.prototype.set_enable_close_event=function(t){this.status.enable_close_event=t,this.postmessage.send("c_set_enable_close_event",t)},e.prototype.set_close_callback_fn=function(t){this.close_callback_fn="("+t.toString()+")()"},e.prototype.set_controls_inactive_time=function(t){this.postmessage.send("c_set_controls_inactive_time",t)},e.prototype.get_lms_data=function(t){if(void 0===t||null==t)throw new Error("Callback function is not defined.");this.lms_data_callback_fn=t,this.postmessage.send("c_get_lms_data")},e.prototype.set_video_visibility=function(t){this.status.video_visibility=t,this.postmessage.send("c_set_video_visibility",t)},e.prototype.get_video_visibility=function(){return this.status.video_visibility},e});
