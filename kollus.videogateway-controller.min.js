/**
 * Kollus-VideogatewayController (06-14-2018)
 * Copyright (c) 2018, Catenoid Incorporated. All rights reserved.
 *
 * @version 0.0.8
 * @license ISC
 */


(function(a){if(typeof define==="function"&&define.amd){define(a())}else if(typeof exports==="object"){a.exports=a()}else{if(typeof window.Kollus==="undefined"){window.Kollus={}}window.Kollus.Utility=a()}})(function(){var a="v0.0.3";var b=window.KollusException=function(a,b){this.message=a;this.code=b||-1;this.toString=function(){return this.message+" ["+this.code+"]"}};if(!Function.prototype.bind){Function.prototype.bind=function(a){if(typeof this!=="function"){throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable")}var b=Array.prototype.slice.call(arguments,1),c=this,d=function(){},e=function(){return c.apply(this instanceof d&&a?this:a,b.concat(Array.prototype.slice.call(arguments)))};d.prototype=this.prototype;e.prototype=new d;return e}}var c={};c.merge_object=function(a,b){for(var c in b){if(b.hasOwnProperty(c)){a[c]=b[c]}}return a};var d=function(a){this.options=c.merge_object({scope:"*",use_log:false},a||{})};d.prototype.log=function(a,b,c){if(this.options.use_log===true&&typeof window.console!=="undefined"){console.log((new Date).toLocaleString()+" - "+a+": ["+this.options.scope+"/"+b+"] "+c)}};d.prototype.info=function(a,b){this.log("info",a,b)};d.prototype.debug=function(a,b){this.log("debug",a,b)};d.prototype.error=function(a,b){this.log("error",a,b)};c.create_logger=function(a){return new d(a)};var e=0;c.uid=function(a){return(a||"kollus")+"-"+e++};c.listen=function(a,c){if(typeof c!=="function"){throw new b("listener is not callable.",-1)}return{to:function(d){if(d.addEventListener){d.addEventListener(a,c,false)}else if(d.attachEvent){d.attachEvent("on"+a,c)}else{throw new b("object does not support event.",-1)}}}};var f=function(){this.listeners={}};f.prototype.on=function(a,c){if(typeof c!=="function"){throw new b("listener is not callable.",-1)}if(typeof this.listeners[a]==="undefined"){this.listeners[a]=[]}this.listeners[a].push(c);return this};f.prototype.off=function(a){if(typeof this.listeners[a]!=="undefined"){for(var b=0,c=this.listeners[a].length;b<c;b++){this.listeners[a][b]=null}this.listeners[a]=[]}return this};f.prototype.trigger=function(){if(arguments.length>=1){var a=Array.prototype.slice.call(arguments),b=a.shift();if(typeof this.listeners[b]!=="undefined"){for(var c=0,d=this.listeners[b].length;c<d;c++){this.listeners[b][c].apply(this,a)}}}};c.create_event_dispatcher=function(){return new f};c.make_fullscreen=function(a){if(a.requestFullscreen){a.requestFullscreen()}else if(a.msRequestFullscreen){a.msRequestFullscreen()}else if(a.mozRequestFullScreen){a.mozRequestFullScreen()}else if(a.webkitRequestFullscreen){a.webkitRequestFullscreen()}};c.delayCallback=function(a,b){var c=new Date;while(new Date-c<=a){}if(b){b()}};return c});(function(a){if(typeof define==="function"&&define.amd){define(a())}else if(typeof exports==="object"){a.exports=a()}else{if(typeof window.Kollus==="undefined"){window.Kollus={}}window.Kollus.PostMessage=a()}})(function(){var a="v0.0.2";var b=false,c=Kollus.Utility.create_logger({scope:"PostMessage",use_log:b});var d=window.KollusPostMessageException=function(a,b){this.message=a;this.code=b||-1;this.toString=function(){return this.message+" ["+this.code+"]"}};var e=function(b){if(b.is_child||false){c.options.scope="<<<---"+c.options.scope}else{c.options.scope="---\x3e>>"+c.options.scope}c.info("SCRIPT_VERSION",a);this.options=Kollus.Utility.merge_object({target_window:null,target_origin:"*",use_uid_check:true,is_child:false},b||{});this.event_dispatcher=new Kollus.Utility.create_event_dispatcher;this.uid=null;if(this.options.use_uid_check){this.uid=Kollus.Utility.uid("kollus-postmessage")}if(typeof window.postMessage==="undefined"){throw new d("this browser does not support postMessage",-99)}try{Kollus.Utility.listen("message",this.receive.bind(this)).to(window)}catch(a){throw new d("can`t attach event to window.",-99)}};e.prototype.on=function(a,b){try{this.event_dispatcher.on(a,b)}catch(a){throw a}return this};e.prototype.send=function(a,b){c.debug("send","event_name -> "+a+", data -> "+b);if(this.options.target_window!==null){return this.options.target_window.postMessage(JSON.stringify({event_name:a,data:typeof b!=="undefined"?b:true,uid:this.uid}),this.options.target_origin)}else{return false}};e.prototype.receive=function(a){if(this.options.target_origin!=="*"&&this.options.target_origin!==a.origin){c.debug("receive","event received, but origin not match. (target_origin: "+this.options.target_origin+", event.origin: "+a.origin+")");return false}try{c.debug("receive",a.data);var b=JSON.parse(a.data);if(this.options.use_uid_check===true&&this.uid!==b.uid){c.debug("receive","not matched uid. this.uid -> "+this.uid+", message.uid -> "+b.uid);return false}if(this.options.use_uid_check===false&&this.uid===null){c.debug("receive","no use_uid_check. message.uid will be set to this.uid. mesasge.uid -> "+b.uid);this.uid=b.uid}if(this.options.is_child&&this.options.target_window===null){c.debug("receive","this window is child. target_window will be set as event.source.");this.options.target_window=a.source}this.event_dispatcher.trigger(b.event_name,b.data)}catch(a){throw new d(a.message,-1)}};return e});(function(a){if(typeof define==="function"&&define.amd){define(a())}else if(typeof exports==="object"){a.exports=a()}else{if(typeof window.Kollus==="undefined"){window.Kollus={}}window.Kollus.VideogatewayController=a()}})(function(){var a="v0.0.8";var b=false,c=Kollus.Utility.create_logger({scope:"VideogatewayController",use_log:b});var d=window.KollusVideogatewayControllerException=function(a,b){this.message=a;this.code=b||-1;this.toString=function(){return this.message+" ["+this.code+"]"}};var e=function(b){c.info("SCRIPT_VERSION",a);var d=this;this.status={progress:{percent:0,position:0,duration:0},screen:"windowed",volume:50,muted:false,jumpstep:10,scalemode:"letterbox",control_visibility:true,speed:1,topmost:false,video:{brightness:0,contrast:0,saturation:0},subtitle_visibility:true,playback_rates:null,player_id:null,hardware_id:null,player_type:null,video_info:null,enable_close_event:false,lms_data:null};this.close_callback_fn=null;this.lms_data_callback_fn=null;document.onkeydown=function(a){if(!d.status.enable_close_event)return;var b=window.event||a;if(b.keyCode==8||b.keyCode==116||b.keyCode==82&&b.ctrlKey){b.keyCode=0;return false}};this.postmessage=new Kollus.PostMessage(b);var e=false,f=0,g=50,h=setInterval(function(){if(++f>=g){clearInterval(h);c.debug("initialized","max initialize try reached.")}if(e===true){clearInterval(h);c.debug("initialized","receive initialized & clear interval function.")}else{d.postmessage.send("c_initialize",true);c.debug("initialize","send initialize command.")}},100);this.event_dispatcher=Kollus.Utility.create_event_dispatcher();this.postmessage.on("e_initialized",function(){e=true}).on("e_progress",function(a){d.status.progress=Kollus.Utility.merge_object(d.status.progress,a);d.event_dispatcher.trigger("progress",a.percent*1,a.position*1,a.duration*1)}).on("e_screenchange",function(a){d.status.screen=a;d.event_dispatcher.trigger("screenchange",a)}).on("e_volumechange",function(a){d.status.volume=a*1;d.event_dispatcher.trigger("volumechange",a*1)}).on("e_muted",function(a){d.status.muted=a;d.event_dispatcher.trigger("muted",a)}).on("e_play",function(){d.event_dispatcher.trigger("play")}).on("e_pause",function(){d.event_dispatcher.trigger("pause")}).on("e_done",function(){d.event_dispatcher.trigger("done")}).on("e_ready",function(){d.event_dispatcher.trigger("ready")}).on("e_loaded",function(){d.event_dispatcher.trigger("loaded");d.postmessage.send("c_set_close_callback_fn",d.close_callback_fn)}).on("e_jumpstepchange",function(a){d.status.jumpstep=a*1;d.event_dispatcher.trigger("jumpstepchange",a*1)}).on("e_scalemode",function(a){d.status.scalemode=a;d.event_dispatcher.trigger("scalemodechange",a)}).on("e_speedchange",function(a){d.status.speed=a;d.event_dispatcher.trigger("speedchange",a)}).on("e_topmost",function(a){d.status.topmost=a;d.event_dispatcher.trigger("topmostchange",a)}).on("e_videosettingchange",function(a){d.status.video=Kollus.Utility.merge_object(d.status.video,a);d.event_dispatcher.trigger("videosettingchange",a)}).on("e_html5_video_supported",function(a){d.event_dispatcher.trigger("html5_video_supported",a)}).on("e_playbackrateschange",function(a){d.status.playback_rates=a;d.event_dispatcher.trigger("playbackrateschange",a)}).on("e_subtitlevisibilitychange",function(a){d.status.subtitle_visibility=a;d.event_dispatcher.trigger("subtitlevisibilitychange",a)}).on("e_error",function(a){d.event_dispatcher.trigger("error",a)}).on("e_fetch_player_id",function(a){d.status.player_id=a}).on("e_fetch_hardware_id",function(a){d.status.hardware_id=a}).on("e_fetch_player_type",function(a){d.status.player_type=a}).on("e_fetch_video_info",function(a){d.status.video_info=a}).on("e_close",function(){c.debug("e_close","close");d.event_dispatcher.trigger("close")}).on("e_fetch_lms_data",function(a){c.debug("e_fetch_lms_data",a);d.lms_data_callback_fn(a)})};e.prototype.on=function(a,b){this.event_dispatcher.on(a,b);return this};e.prototype.off=function(a){this.event_dispatcher.off(a);return this};e.prototype.get_progress=function(){return this.status.progress};e.prototype.play=function(a){this.postmessage.send("c_play",a)};e.prototype.pause=function(){this.postmessage.send("c_pause")};e.prototype.set_volume=function(a){this.postmessage.send("c_set_volume",Math.min(100,Math.max(0,a)))};e.prototype.get_volume=function(){return this.status.volume};e.prototype.mute=function(){this.postmessage.send("c_mute")};e.prototype.ff=function(){this.postmessage.send("c_ff")};e.prototype.rw=function(){this.postmessage.send("c_rw")};e.prototype.set_screen=function(){this.postmessage.send("c_set_screen")};e.prototype.get_screen=function(){return this.status.screen};e.prototype.set_jumpstep=function(a){this.postmessage.send("c_set_jumpstep",a*1)};e.prototype.get_jumpstep=function(){return this.status.jumpstep};e.prototype.set_control_visibility=function(a){this.postmessage.send("c_set_control_visibility",a);this.status.control_visibility=a};e.prototype.get_control_visibility=function(){return this.status.control_visibility};e.prototype.set_scalemode=function(a){if("|letterbox|stretch|zoom|none|".indexOf(a)>=0){this.postmessage.send("c_set_scalemode",a)}};e.prototype.get_scalemode=function(){return this.status.scalemode};e.prototype.set_speed=function(a){this.postmessage.send("c_set_speed",parseFloat(a).toFixed(2))};e.prototype.get_speed=function(){return this.status.speed};e.prototype.set_topmost=function(a){this.postmessage.send("c_set_topmost",a?1:0)};e.prototype.get_topmost=function(){return this.status.topmost};e.prototype.set_brightness=function(a){this.postmessage.send("c_set_brightness",Math.min(50,Math.max(-50,a)))};e.prototype.get_brightness=function(){return this.status.video.brightness};e.prototype.set_contrast=function(a){this.postmessage.send("c_set_contrast",Math.min(50,Math.max(-50,a)))};e.prototype.get_contrast=function(){return this.status.video.contrast};e.prototype.set_saturation=function(a){this.postmessage.send("c_set_saturation",Math.min(50,Math.max(-50,a)))};e.prototype.get_saturation=function(){return this.status.video.saturation};e.prototype.set_repeat_start=function(a){this.postmessage.send("c_set_sectiontime",{type:1,value:a||-1})};e.prototype.set_repeat_end=function(a){this.postmessage.send("c_set_sectiontime",{type:2,value:a||-1})};e.prototype.unset_repeat=function(){this.postmessage.send("c_set_sectiontime",{type:0,value:-1})};e.prototype.refresh_bookmark=function(){this.postmessage.send("c_refresh_bookmark")};e.prototype.enable_fullscreen_button=function(){this.postmessage.send("c_enable_fullscreen_button")};e.prototype.set_playback_rates=function(a){this.postmessage.send("c_set_playback_rates",a)};e.prototype.get_playback_rates=function(a){return JSON.parse(this.status.playback_rates)};e.prototype.set_subtitle_visibility=function(a){this.postmessage.send("c_set_subtitle_visibility",a)};e.prototype.get_player_id=function(){return this.status.player_id};e.prototype.get_hardware_id=function(){return this.status.hardware_id};e.prototype.get_player_type=function(){return this.status.player_type};e.prototype.get_video_info=function(){return this.status.video_info};e.prototype.set_lms_check=function(){this.postmessage.send("c_set_lms_check")};e.prototype.set_keyframe_seek_default=function(a){this.postmessage.send("c_set_keyframe_seek_default",a)};e.prototype.set_short_key=function(a){this.postmessage.send("c_set_short_key",a)};e.prototype.set_enable_close_event=function(a){this.status.enable_close_event=a;this.postmessage.send("c_set_enable_close_event",a)};e.prototype.set_close_callback_fn=function(a){this.close_callback_fn="("+a.toString()+")()"};e.prototype.set_controls_inactive_time=function(a){this.postmessage.send("c_set_controls_inactive_time",a)};e.prototype.get_lms_data=function(a){if(typeof a=="undefined"||a==null){throw new Error("Callback function is not defined.")}this.lms_data_callback_fn=a;this.postmessage.send("c_get_lms_data")};return e});